## Анализа

Доделимо жетону на позицији $(x, y)$ вредност $2^{2-x-y}$. Приметимо да се након једног потеза при нормалној игри збир вредности свих жетона неће променити, што значи да је потребан (али не и довољан) услов да Буба каже "Стоп!" да збир вредности свих жетона буде тачно $1$. Пошто се додавањем новог жетона у _debug_ моду ова вредност повећава, ово значи да ће у највише једном тренутку збир вредности свих жетона на табли бити једнак $1$. Ако вредност табле "прескочи" $1$ или никад не достигне $1$, знамо да нема решења.

У тренутку када вредност достигне $1$, покушаћемо да реконструишемо низ потеза који таблу доводи у то стање. Ово ћемо радити грабљивим алгоритмом одназад. Посматрајмо све жетоне у последњој непразној дијагонали (под дијагоналом подразумевамо скуп поља са константном вредношћу $x+y$). Решење постоји ако и само ако се они могу упарити тако да сваки пар чине два жетона који се налазе на пољима која имају заједничко теме.

Ово упаривање се може урадити на јединствен начин, ако је уопште могуће, поново грабљивим алгоритмом редом од жетона са најмањом $x$-координатом. Ако смо успешно упарили све жетоне из ове дијагонале, за сваки пар упарених жетона на позицијама $(x, y+1), (x+1, y)$ креирамо један жетон на позицији $(x, y)$. Овај поступак понављамо све док не дођемо до прве дијагонале или не дођемо у ситуацију да не можемо да упаримо жетоне.

Ако дођемо до стања где је само један жетон у првој дијагонали, решење штампамо као обрнути низ жетона које смо креирали током обиласка дијагонала.
 
##  Смернице за алгоритам

Тренутак када збир вредности свих жетона постане једнак $1$ можемо пронаћи тако што одржавамо бинарни запис разломка који садржи тренутни збир вредности. Када додајемо жетон на позицију $(x,y)$, у помоћном низу $c$ треба повећати број $c_{x+y-2}$ за $1$. Ако његова вредност постане $2$, онда је постављамо на $0$ и исти поступак понављамо за цифру на позицији $x+y-3$, и тако даље, до заустављања.

Амортизованом анализом сложености се може показати да овај поступак има временску сложеност $O(N)$. У решењу доминира временска сложеност за сортирање сваке дијагонале, пошто ће све оне укупно садржати $O(N)$ жетона временска сложеност је $O(N \log N)$ док је меморијска сложеност $O(N)$.