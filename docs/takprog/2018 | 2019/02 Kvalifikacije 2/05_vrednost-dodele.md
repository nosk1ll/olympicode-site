
Означимо скуп $\{1, 2, \ldots, N\}$ са $[[N]]$.
Посматрајмо доделе вредности за $i = 0$ и дефинишимо две функције 

* $f : [[N]] \rightarrow [[N]]$, таква да је $a'_j = f(a_j)$, где је $a'_j$ вредност на позицији $j$ у низу $A$ након извршавања додела вредности за $i = 0$ а $a_j$ је та вредност пре извршавања додела.
* $g : [[N]] \rightarrow [[N]], g(N) := 1; g(x) := x + 1, x \neq N$ циклично померање за једно место улево.

Сада ћемо операцију коју треба извршити на низу $A$ (за свако $i \in \{0, 1, \ldots, N-M \}$ и за свако $j \in \{0, 1, \ldots, M-1\}$) означити са $z$, где је $z : [[N]] \rightarrow [[N]]$. Означимо са $z_i : [[N]] \rightarrow [[N]]$ операцију на низу $A$ која одговара извршавању унутрашње фор-петље (по $j$) за дато фиксно $i$. Јасно је да важи: $z = z_{N-M} \circ z_{N-M-1} \circ \ldots \circ z_0$. Кључна идеја је то што $z_i$ можемо записати у облику $z_i = g^{-i} \circ f \circ g^i$. Ово важи зато што пресликавањем $g^i$ "ротирамо" низ у такву позицију да елемент који је био на позицији $i$ је сада на позицији $0$. Након тога примењујемо доделу вредности са $f$ и поново ротирамо низ у контра смеру за $i$ места.

Ако затим проширимо израз за $z$ и скратимо суседне парове $\ldots g^{i} \circ g^{-(i-1)} \ldots$ остаје нам $z = g^{-(N-M)} \circ (f \circ g)^{N-M} \circ f$, односно, краће $z = g^{-k} \circ (g \circ f)^k$, где смо увели ознаку $k := N-M+1$. Како се $g^{-k}$ лако рачуна као десна ротација за $k$ места, ако уведемо ознаку $h := g \circ f$ остаје нам да израчунамо $k$-ти  степен ове функције.

Да бисмо за свако $i$ пронашли вредност $h^k(i)$ конструишемо граф са чворовима $\{1 \ldots N\}$ и усмереним гранама $\{x \rightarrow h(x), x \in [[N]]\}$. Како је усмерен, коначан и из сваког чвора излази тачно једна грана, компоненте повезаности (посматрајући граф као неусмерен) изгледају као циклуси са стаблима чији је тачно један чвор део циклуса (приметити да како је могуће да $h(i) = i$ постоји могућност да циклус садржи само један чвор). Усмерење грана у циклусу мора бити такво да је циклус и у усмереном графу, док усмерење грана у стаблима мора бити такво да је улазни чвор ближи циклусу од излазног.

Обилазећи сваку компоненту повезаности (посматрајући граф као неусмерен) у њој проналазимо циклус за чији сваки чвор налазимо $h^k(i)$ као $c((id(i) + k) \mod d)$ где је $d$ дужина циклуса који садржи чвор $i$, $idx(x)$ даје редни број чвора $x$ у циклусу док $c(x)$ означава $x$-ти чвор на том циклусу. За "почетак" циклуса можемо изабрати произвољан чвор. Затим _dfs_ обиласком, кроз стабла повезана са тим циклусом, уназад (супротно усмерењу грана) за сваки чвор $i$ чији је отац у стаблу обиласка $o_i$ рачунамо $h^k(i)$ или као претходника чвора $h^k(o_i)$ у циклусу уколико је $i$ на растојању од циклуса мањем од $k$ или као сина чвора $h^k(o(i))$ у стаблу обиласка у чијем подстаблу се налази чвор $i$. Овог сина можемо наћи тако што одржавамо низ који одговара стеку чворова током _dfs_-а и узимањем $k$-тог претходника тренутног чвора.

На крају потребно је само израчунати тражену вредност, знајући вредности низа $A$ након свих додела вредности.

* Временска сложеност алгоритма $O(n)$
* Просторна сложеност алгоритма $O(n)$
